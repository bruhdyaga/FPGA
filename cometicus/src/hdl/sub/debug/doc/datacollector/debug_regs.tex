\section{Описание}
\label{sec:descr}
Блок сбора данных позволяет записывать отчеты, поступающие на его входы. В
данной имплементации на входы блока сбора данных поступают: 8 - каналов АЦП,
действительная и мнимая части 1-го бимформера, действительная и мнимая части
знакового разряда 1-7 бимформера, 1-й нульформер. Разрядность собираемых
отсчетов 16.
\newline
Базовый адрес блока сбора данных: 0xB0012000.

\section{Программная модель}
\label{sec:pmodel}
Упрвление блоком сбора данных производится поканально. Для этого в регистр
\nameref{sec:CHAN} записывается номер соответствующего канала. Далее в регистр
\nameref{sec:WREN} записываем 0 или 1 для запрещения или разрешения записи в
канал. Обязательно необходимо записать число собираемых отсчетов в регистр
\nameref{sec:WRDEPTH}. Запуск сбора данных в канале осуществляется записью 1 в
регистр \nameref{sec:TRIG}. Завершение сбора данных контролилует также регистр
\nameref{sec:TRIG}: 1 - не завершено, 0 - завершено. Чтение самих данных
осущесвляется из регистра \nameref{sec:RAM} по принципу FIFO.

\section{Регистры блока сбора данных}
\label{sec:commons}

\subsection{Карта регистров блока сбора данных}
\begin{longtable}{| l | l | l | p{7.5cm} |}
\hline
\textbf{Имя} & \textbf{Смещение} & \textbf{R/W} & \textbf{Описание} \\ \hline

\nameref{sec:ID} & 0x0 & R & Идентификатор блока сбора данных
\newline \textbf{Значение по сбросу:} 0xB0BA6663 \\ \hline

\nameref{sec:NUM} & 0x4 & R & Номер блока сбора данных
\newline \textbf{Значение по сбросу:} 0x1 \\ \hline

\nameref{sec:PORTS} & 0x8 & R & Количество каналов блока сбора данных
\newline \textbf{Значение по сбросу:} 0xС \\ \hline

\nameref{sec:WIDTH} & 0xC & R & Разрядность канала блока сбора данных
\newline \textbf{Значение по сбросу:} 0x10 \\ \hline

\nameref{sec:DEPTH} & 0x10 & R & Объем канала блока сбора данных
\newline \textbf{Значение по сбросу:} 0x800 \\ \hline

\nameref{sec:RESET} & 0x14 & W & Сброс блока сбора данных
\newline \textbf{Значение по сбросу:} 0x0 \\ \hline

\nameref{sec:CHAN} & 0x18 & R/W & Номер канала блока сбора данных
\newline \textbf{Значение по сбросу:} 0x0 \\ \hline

\nameref{sec:TRIG} & 0x1C & R/W & Триггер старта канала блока сбора данных
\newline \textbf{Значение по сбросу:} 0x0 \\ \hline

\nameref{sec:WREN} & 0x20 & R/W & Разрешение записи канала блока сбора данных
\newline \textbf{Значение по сбросу:} 0x0 \\ \hline

\nameref{sec:WRDEPTH} & 0x24 & R/W & Объем записи каналов блока сбора данных
\newline \textbf{Значение по сбросу:} 0x0 \\ \hline

\nameref{sec:RAM} & 0x2C & R & Отсчет канала блока сбора данных
\newline \textbf{Значение по сбросу:} 0x0 \\ \hline
\end{longtable}

\subsection{Описание регистров}

\subsection{ID}
\label{sec:ID}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Идентификатор блока сбора данных
  \item \textbf{Смещение:} 0x0
  \item \textbf{R/W:} R
\end{itemize}
\begin{register}{H}{ID}{0x0}
\regfield{ID}{32}{0}{{0xB0BA6663}}%
\regnewline%
\end{register}

\subsection{NUM}
\label{sec:NUM}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Номер блока сбора данных
  \item \textbf{Смещение:} 0x4
  \item \textbf{R/W:} R
\end{itemize}
\begin{register}{H}{NUM}{0x4}
\regfield{NUM}{32}{0}{{0x1}}%
\regnewline%
\end{register}

\subsection{PORTS}
\label{sec:PORTS}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Количество каналов блока сбора данных
  \item \textbf{Смещение:} 0x8
  \item \textbf{R/W:} R
\end{itemize}
\begin{register}{H}{PORTS}{0x8}
\regfield{PORTS}{32}{0}{{0xC}}%
\regnewline%
\end{register}


\subsection{WIDTH}
\label{sec:WIDTH}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Разрядность канала блока сбора данных
  \item \textbf{Смещение:} 0xC
  \item \textbf{R/W:} R
\end{itemize}
\begin{register}{H}{WIDTH}{0xC}
\regfield{WIDTH}{32}{0}{{0x10}}%
\regnewline%
\end{register}

\subsection{DEPTH}
\label{sec:DEPTH}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Объем канала блока сбора данных
  \item \textbf{Смещение:} 0x10
  \item \textbf{R/W:} R
\end{itemize}
\begin{register}{H}{DEPTH}{0x10}
\regfield{DEPTH}{32}{0}{{0x800}}%
\regnewline%
\end{register}

\subsection{RESET}
\label{sec:RESET}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Сброс блока сбора данных
  \item \textbf{Смещение:} 0x14
  \item \textbf{R/W:} W
\end{itemize}
\begin{register}{H}{RESET}{0x14}
\regfield{reserved}{31}{1}{{xxxxxxxxxxxxxxxx}}%
\regfield{rst}{1}{0}{{0}}%
\regnewline%
\end{register}
\begin{longtable}{| l | l | l | p{7.5cm} |}
\hline
\textbf{Биты} & \textbf{Имя} & \textbf{R/W} & \textbf{Описание} \\ \hline
31:1 & - & - & Зарезервировано \\ \hline
0 & rst & W & 1 - Сброс блока сбора данных
\newline 0 - Не влияет
\newline \textbf{Значение по сбросу:} 0 \\ \hline 
\end{longtable}

\subsection{CHAN}
\label{sec:CHAN}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Номер канала блока сбора данных
  \item \textbf{Смещение:} 0x18
  \item \textbf{R/W:} R/W
\end{itemize}
\begin{register}{H}{CHAN}{0x18}
\regfield{reserved}{29}{3}{{xxxxxxxxxxxxxxxx}}%
\regfield{channel}{3}{0}{000}%
\regnewline%
\end{register}
\begin{longtable}{| l | l | l | p{7.5cm} |}
\hline
\textbf{Биты} & \textbf{Имя} & \textbf{R/W} & \textbf{Описание} \\ \hline
29:3 & - & - & Зарезервировано \\ \hline
2:0 & channel & R/W & Номер канала блока сбора данных
\newline 000 - 1-й канал
\newline 001 - 2-й канал
\newline \ldots
\newline 111 - 8-й канал
\newline \textbf{Значение по сбросу:} 0 \\ \hline 
\end{longtable}

\subsection{TRIG}
\label{sec:TRIG}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Триггер старта канала блока сбора данных
  \item \textbf{Смещение:} 0x1C
  \item \textbf{R/W:} R/W
\end{itemize}
\begin{register}{H}{TRIG}{0x1C}
\regfield{reserved}{31}{1}{{xxxxxxxxxxxxxxxx}}%
\regfield{trig}{1}{0}{{0}}%
\regnewline%
\end{register}
\begin{longtable}{| l | l | l | p{7.5cm} |}
\hline
\textbf{Биты} & \textbf{Имя} & \textbf{R/W} & \textbf{Описание} \\ \hline
31:1 & - & - & Зарезервировано \\ \hline
0 & trig & R/W & \textbf{Запись:}
\newline 1 - Запуск канла сбора данных
\newline 0 - Не влияет
\newline \textbf{Чтение:}
\newline 1 - Запись не закончена
\newline 0 - Запись закончена
\newline \textbf{Значение по сбросу:} 0 \\ \hline 
\end{longtable}

\subsection{WREN}
\label{sec:WREN}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Разрешение записи канала блока сбора данных
  \item \textbf{Смещение:} 0x20
  \item \textbf{R/W:} R/W
\end{itemize}
\begin{register}{H}{WREN}{0x20}
\regfield{reserved}{31}{1}{{xxxxxxxxxxxxxxxx}}%
\regfield{wren}{1}{0}{{0}}%
\regnewline%
\end{register}
\begin{longtable}{| l | l | l | p{7.5cm} |}
\hline
\textbf{Биты} & \textbf{Имя} & \textbf{R/W} & \textbf{Описание} \\ \hline
31:1 & - & - & Зарезервировано \\ \hline
0 & wren & R/W & 1 - Запись канала разрешена
\newline 0 - Запись канала запрещена
\newline \textbf{Значение по сбросу:} 0 \\ \hline 
\end{longtable}

\subsection{WRDEPTH}
\label{sec:WRDEPTH}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Объем записи канала блока сбора данных
  \item \textbf{Смещение:} 0x24
  \item \textbf{R/W:} R/W
\end{itemize}
\begin{register}{H}{WRDEPTH}{0x24}
\regfield{reserved}{20}{12}{{xxxxxxxxxxxxxxxx}}%
\regfield{wrdepth}{12}{0}{{0}}%
\regnewline%
\end{register}
\begin{longtable}{| l | l | l | p{7cm} |}
\hline
\textbf{Биты} & \textbf{Имя} & \textbf{R/W} & \textbf{Описание} \\ \hline
31:12 & - & - & Зарезервировано \\ \hline
11:0 & wrdepth & R/W & Необходимый объем данных:
\newline 0 - Запрещено
\newline 1 - 1 отсчет
\newline 1 - 2 отсчета
\newline \ldots
\newline 2048 - 2048 отсчета
\newline \textbf{Значение по сбросу:} 0 \\ \hline 
\end{longtable}

\subsection{RAM}
\label{sec:RAM}
\begin{itemize}
  \setlength{\itemsep}{0pt}
  \setlength{\parskip}{0pt}
  \setlength{\parsep}{0pt}
  \item \textbf{Имя:} Отсчет канала блока сбора данных
  \item \textbf{Смещение:} 0x2C
  \item \textbf{R/W:} R
\end{itemize}
\begin{register}{H}{RAM}{0x2C}
\regfield{RAM}{32}{0}{{0x0}}%
\regnewline%
\end{register}

